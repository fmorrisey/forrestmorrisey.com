---
import BaseLayout from "../../layouts/BaseLayout.astro";
import HeroBanner from "../../components/HeroBanner.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const videos = await getCollection("youtube");
  return videos.map(video => ({
    params: { slug: video.slug },
    props: { video }
  }));
}

const { video } = Astro.props;
const { Content } = await render(video);
const { title, heroImage, heroSubtitle, description, videoId, playlistId, channelUrl } = video.data;
---

<BaseLayout title={`${title} — Forrest Morrisey`} fullWidth={true}>
  <HeroBanner 
    image={heroImage}
    title={title}
    subtitle={heroSubtitle || description}
    height="medium"
  />

  <article class="section">
    <div class="container">
      {/* YouTube Video Embed */}
      {videoId && (
        <div class="video-container mb-lg">
          <iframe 
            src={`https://www.youtube.com/embed/${videoId}`}
            title={title}
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
          ></iframe>
        </div>
      )}

      {/* YouTube Playlist Embed */}
      {playlistId && !videoId && (
        <div class="video-container mb-lg">
          <iframe 
            src={`https://www.youtube.com/embed/videoseries?list=${playlistId}`}
            title={title}
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
          ></iframe>
        </div>
      )}

      <div class="prose">
        <Content />
      </div>

      {channelUrl && (
        <div class="mt-lg text-center">
          <a href={channelUrl} target="_blank" rel="noopener noreferrer" class="btn btn-primary btn-pill">
            Subscribe on YouTube
          </a>
        </div>
      )}
    </div>
  </article>

  <nav class="section text-center">
    <a href="/youtube" class="btn btn-outline btn-pill">← Back to YouTube</a>
  </nav>
</BaseLayout>

<style>
  .video-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    border-radius: 8px;
    overflow: hidden;
    background: var(--card);
  }

  .video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>
